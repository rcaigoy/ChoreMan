
@{
    ViewBag.Title = "EditChoreList";
}

<h2>Chore:  @ViewBag.ChoreList.Name</h2>

<div id="SaveForm">
</div>
<div id="ChoreListForm">
    <label>ChoreListType</label>
    <select id="ChoreListTypeId">
        <option value="@ViewBag.ChoreList.ChoreListTypeId">@ViewBag.ChoreList.ChoreListTypeName</option>
        <option value="1">Skip</option>
        <option value="2">Overload</option>
    </select>
    <br />

    <button id="Save">Save</button>
    <button class="Cancel">Cancel</button>
    <br />

    <br />

    <div id="ChoreUsersList">
        <h2>Users</h2>
        <br />

        <br />

        <table id="ChoreUsersTable">
            @foreach (var ChoreUser in ViewBag.ChoreList.ChoreUsers)
            {
                <tr>
                    <td>
                        <label>@ChoreUser.FirstName @ChoreUser.LastName</label>
                    </td>

                    <td>
                        <label>@ChoreUser.Phone</label>
                    </td>

                    <td>
                        @if (ChoreUser.IsVerified)
                        {
                            <label>Verified</label>
                        }
                        else
                        {
                            <label>Not Verified</label>
                        }
                    </td>

                    <td>
                        <button class="EditUser" name="@ChoreUser.Id">Edit User</button>
                    </td>
                </tr>
            }
        </table>
        <br />
        <button id="AddUser">Add User</button>
    </div>
    <br />

    <br />

    <div id="ChoresList">
        <h2>Chores</h2>
        <br />

        <table id="ChoresTable">
            @foreach (var Chore in ViewBag.ChoreList.Chores)
            {
                <tr>
                    <td>
                        <label>@Chore.Name</label>
                    </td>

                    <td>
                        <button class="EditChore" name="@Chore.Id">Edit Chore</button>
                    </td>
                </tr>
            }
        </table>
        <br />
        <button>Add Chore</button>
    </div>
    <br />

    <br />

    <div id="RotationIntervalsList">
        <h2>Scheduled Rotations</h2>
        <br />

        <table id="RotationIntervalsTable">
            @foreach (var RotationInterval in ViewBag.ChoreList.RotationIntervals)
            {
                <tr>
                    <td>
                        <label>Start Date:  @RotationInterval.StartDate</label>
                    </td>

                    <td>
                        <label>Send every:  @RotationInterval.Number</label>
                    </td>

                    <td>
                        <label>@RotationInterval.IntervalTypeName</label>
                    </td>

                    <td>
                        <button class="EditRotation" name="@RotationInterval.Id">Edit</button>
                    </td>
                </tr>
            }
        </table>

        <button id="AddRotation">Add Schedule Rotation</button>
    </div>
    <br />

</div>


<div class="Popup" id="UserPopup">
    <h2 class="PopupTitle">Add User</h2>
    <br />

    <label>First Name</label>
    <input type="text" id="UserFirstName" />
    <br />

    <label>Last Name</label>
    <input type="text" id="UserLastName" />
    <br />

    <label>Phone</label>
    <input type="tel" id="UserPhone" />
    <br />

    <label>Email</label>
    <input type="email" id="UserEmail" />
    <br />

    <button id="SubmitUserButton">Submit</button>
    <button class="Cancel">Cancel</button>

    <br />
    <button id="RemoveUser">Remove User</button>
</div>

<div id="ChorePopup">
    <h2 class="PopupTitle">Add Chore</h2>

    <br />

    <button id="SubmitChoreButton">Submit</button>
    <button class="Cancel">Cancel</button>
</div>

<div id="RotationPopup">
    <h2 class="PopupTitle">Add Rotation</h2>
    <label>Start Date</label>
    <input type="text" id="RotationStartDate" />
    <br />

    <label>IntervalType</label>
    <select>
        <option value="1">Days</option>
        <option value="2">Business Days</option>
        <option value="3">Months</option>
    </select>
    <br />

    <label>Active</label>
    <input type="checkbox" />
    <br />

    <br />

    <button>Add Rotation</button>
    <button class="Cancel">Cancel</button>
</div>

@section scripts {

    <script src='https://cdnjs.cloudflare.com/ajax/libs/dragula/$VERSION/dragula.min.js'></script>

    <script>
        $(document).ready(function () {

            $('.Cancel').on('click', function () {
                window.location.reload();
            });//end $('.Cancel').on('click', function () {

            //Add or Edit User Popup button
            $('#AddUser, .EditUser').on('click', function () {
                SubmitUserButton.name = this.name;
                if (this.name) {
                    //get chore user object
                    $.ajax({
                        url: '@Url.Action("GetChoreUser", "API")'
                            + '?AuthToken=' + '@ViewBag.User.AuthToken'
                            + '&Id=' + SubmitUserButton.name,
                        type: 'GET',
                        success: function (data) {
                            UserFirstName.value = data.FirstName;
                            UserLastName.value = data.LastName;
                            UserPhone.value = data.Phone;
                            UserEmail.value = data.Email;
                        },
                        error: function (data) {
                            console.log(data);
                            alert('Error');
                        }
                    });//end $.ajax({
                }
                else {
                    UserFirstName.value = '';
                    UserLastName.value = '';
                    UserPhone.value = '';
                    UserEmail.value = '';
                }
            });//end $('#AddUser').on('click', function () {


            //Add User Submit Button
            $('#SubmitUserButton').on('click', function () {
                let ChoreUserObject = {};

                    ChoreUserObject['ChoreListId'] = @ViewBag.ChoreList.Id;
                    ChoreUserObject['Phone'] = UserPhone.value;
                    ChoreUserObject['Email'] = UserEmail.value;
                    ChoreUserObject['FirstName'] = UserFirstName.value;
                    ChoreUserObject['LastName'] = UserLastName.value;

                if (this.name) {
                    let ChoreUserId = this.name;

                    $.ajax({
                        url: '@Url.Action("UpdateChoreUser", "API")'
                            + '?AuthToken=' + '@ViewBag.User.AuthToken'
                            + '&Id=' + ChoreUserId
                            + '&ChoreUserValues=' + escape(JSON.stringify(ChoreUserObject))
                        ,
                        type: 'POST',
                        success: function (data) {
                            window.location.reload();
                            alert('Success');
                        },
                        error: function (data) {
                            console.log(data);
                            alert('Error');
                        }
                    });//end $.ajax({
                    
                }//end if (this.name){

                //if not this.name
                else {
                    $.ajax({
                        url: '@Url.Action("AddChoreUser", "API")'
                            + '?AuthToken=' + '@ViewBag.User.AuthToken'
                            + '&ChoreUserValues=' + escape(JSON.stringify(ChoreUserObject)),
                        type: 'POST',
                        success: function (data) {
                            window.location.reload();
                        },
                        error: function (data) {
                            console.log(data);
                            alert('Error');
                        }
                    });//end $.ajax({
                }


            });//end $('#SubmitUserButton').on('click', function () {

        });//end $(document).ready(function () {
    </script>
}
